// Basic DROP INDEX functionality
test(
    memory,
    drop_index_basic_1,
    [
        "CREATE TABLE t1(x INTEGER PRIMARY KEY)",
        "CREATE INDEX t_idx on t1 (x)",
        "INSERT INTO t1 VALUES (1)",
        "INSERT INTO t1 VALUES (2)",
        "DROP INDEX t_idx",
        "SELECT count(*) FROM sqlite_schema WHERE type='index' AND name='t_idx'"
    ],
    0
)

// Test DROP INDEX IF EXISTS on existing index
test(
    memory,
    drop_index_if_exists_1,
    [
        "CREATE TABLE t2(x INTEGER PRIMARY KEY)",
        "CREATE INDEX t_idx2 on t2 (x)",
        "DROP INDEX IF EXISTS t_idx2",
        "SELECT count(*) FROM sqlite_schema WHERE type='index' AND name='t_idx2'"
    ],
    0
)

// Test DROP INDEX IF EXISTS on non-existent index
test(
    memory,
    drop_index_if_exists_2,
    [
        "DROP TABLE IF EXISTS nonexistent_index",
        "SELECT 'success'"
    ],
    "success"
)

// Test dropping non-existant index produces an error
test_error(
    drop_index_no_index,
    "DROP INDEX t_idx"
)

// Test dropping index after multiple inserts and deletes
test(
    memory,
    drop_index_after_ops_1,
    [
        "CREATE TABLE t6(x INTEGER PRIMARY KEY)",
        "CREATE INDEX t_idx6 on t6 (x)",
        "INSERT INTO t6 VALUES (1)",
        "INSERT INTO t6 VALUES (2)",
        "DELETE FROM t6 WHERE x = 1",
        "INSERT INTO t6 VALUES (3)",
        "DROP INDEX t_idx6",
        "SELECT count(*) FROM sqlite_schema WHERE type='index' AND name='t_idx6'"
    ],
    0
)